<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Emoji Crush 4D Ultra</title>
    <style>
        /* 4D Animated Professional Background */
        body { 
            background: linear-gradient(135deg, #1a0033 0%, #4b0082 50%, #000033 100%);
            background-size: 300% 300%; animation: bgShift 10s ease infinite;
            margin: 0; padding: 0; display: flex; flex-direction: column; 
            height: 100vh; width: 100vw; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none;
        }
        @keyframes bgShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* Modern Glass Score Board */
        .score-container {
            height: 12vh; width: 100%; display: flex; justify-content: center; align-items: center;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.2); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .score-box { text-align: center; color: gold; }
        #score { font-size: 45px; font-weight: 900; text-shadow: 0 0 20px gold; }

        /* Full Screen Grid with Big Emojis */
        .grid { 
            flex-grow: 1; display: grid; 
            grid-template-columns: repeat(7, 1fr); grid-template-rows: repeat(9, 1fr);
            width: 100vw; gap: 3px; padding: 10px; box-sizing: border-box;
            background: rgba(255,255,255,0.05);
        }

        .candy { 
            display: flex; align-items: center; justify-content: center;
            font-size: 11vw; /* Bade Emojis */
            user-select: none; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
        }

        /* 4D Pop-up Text */
        #msg { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 80px; font-weight: 900; color: #fff; z-index: 100;
            text-shadow: 0 0 30px #ff007f, 0 0 60px #ff007f; display: none; pointer-events: none;
            animation: bounceIn 0.6s ease-out;
        }
        @keyframes bounceIn { 0% { transform: translate(-50%, -50%) scale(0.2); opacity: 0; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div class="score-container">
        <div class="score-box">
            <div style="font-size: 14px; letter-spacing: 2px;">SCORE</div>
            <div id="score">0</div>
        </div>
    </div>

    <div id="msg">SWEET! üç¨</div>
    <div class="grid" id="grid"></div>

    <script>
        const grid = document.getElementById('grid');
        const scoreDisplay = document.getElementById('score');
        const msg = document.getElementById('msg');
        const width = 7, height = 9;
        const items = ['üç≠', 'üçì', 'üçá', 'üçí', 'üíé', 'üß®', 'üöÄ']; // üß® is Grenade, üöÄ is Booster
        let squares = [];
        let score = 0;

        // Sound System
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type = 'sine') {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        function createBoard() {
            for (let i = 0; i < width * height; i++) {
                const square = document.createElement('div');
                square.className = 'candy'; square.setAttribute('id', i);
                square.innerHTML = items[Math.floor(Math.random() * 5)];
                grid.appendChild(square); squares.push(square);
                square.addEventListener('touchstart', tStart);
                square.addEventListener('touchend', tEnd);
            }
        }

        let sX, sY, dId;
        function tStart(e) { dId = parseInt(this.id); sX = e.touches.clientX; sY = e.touches.clientY; this.style.transform = "scale(0.8)"; }

        function tEnd(e) {
            this.style.transform = "scale(1)";
            let eX = e.changedTouches.clientX, eY = e.changedTouches.clientY;
            let dX = eX - sX, dY = eY - sY, tId = dId;

            if (Math.abs(dX) > Math.abs(dY)) {
                if (dX > 35 && dId % width !== width - 1) tId = dId + 1;
                else if (dX < -35 && dId % width !== 0) tId = dId - 1;
            } else {
                if (dY > 35 && dId + width < width * height) tId = dId + width;
                else if (dY < -35 && dId - width >= 0) tId = dId - width;
            }

            if (tId !== dId) {
                let temp = squares[dId].innerHTML;
                squares[dId].innerHTML = squares[tId].innerHTML;
                squares[tId].innerHTML = temp;
                
                // Booster Logic
                if (temp === 'üß®') { triggerGrenade(tId); }
                else if (temp === 'üöÄ') { triggerRocket(tId); }
                
                playSound(600);
                setTimeout(checkMatches, 150);
            }
        }

        function triggerGrenade(idx) {
            let area = [idx, idx-1, idx+1, idx-width, idx+width, idx-width-1, idx-width+1, idx+width-1, idx+width+1];
            area.forEach(i => { if(squares[i]) squares[i].innerHTML = items[Math.floor(Math.random()*5)]; });
            showMsg('BOOM! üí•'); playSound(200, 'square');
            score += 200; scoreDisplay.innerText = score;
        }

        function triggerRocket(idx) {
            let rowStart = idx - (idx % width);
            for(let i=0; i<width; i++) squares[rowStart + i].innerHTML = items[Math.floor(Math.random()*5)];
            showMsg('ROCKET! üöÄ'); playSound(800, 'sawtooth');
            score += 150; scoreDisplay.innerText = score;
        }

        function showMsg(txt) {
            msg.innerText = txt; msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 800);
        }

        function checkMatches() {
            let found = false;
            for (let i = 0; i < width * height; i++) {
                let r3 = [i, i+1, i+2], c3 = [i, i+width, i+width*2];
                let current = squares[i].innerHTML;
                if (current === 'üß®' || current === 'üöÄ') continue;

                if (i % width < width - 2 && r3.every(idx => squares[idx] && squares[idx].innerHTML === current)) {
                    score += 50; found = true;
                    r3.forEach(idx => squares[idx].innerHTML = Math.random() > 0.9 ? 'üß®' : items[Math.floor(Math.random()*5)]);
                }
                if (i < width * (height - 2) && c3.every(idx => squares[idx] && squares[idx].innerHTML === current)) {
                    score += 50; found = true;
                    c3.forEach(idx => squares[idx].innerHTML = Math.random() > 0.9 ? 'üöÄ' : items[Math.floor(Math.random()*5)]);
                }
            }
            if (found) { scoreDisplay.innerText = score; showMsg('NICE! ‚ú®'); playSound(1000); }
        }
        createBoard();
    </script>
</body>
</html>
